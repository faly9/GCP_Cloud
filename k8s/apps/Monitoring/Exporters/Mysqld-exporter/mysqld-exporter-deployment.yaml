# mysqld-exporter-deployment.yaml (Configuration du ConfigMap)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysqld-exporter
  namespace: freelance
  labels:
    app: mysqld-exporter
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mysqld-exporter
  template:
    metadata:
      labels:
        app: mysqld-exporter
    spec:
      containers:
        - name: mysqld-exporter
          image: prom/mysqld-exporter:latest
          resources:
            requests:
              memory: "150Mi"
              cpu: "50m"
            limits:
              memory: "200Mi"
              cpu: "100m"
          ports:
            - containerPort: 9104
              name: metrics
          # NOUVEAU : Arguments pour pointer vers le fichier de configuration
          args:
            - --config.my-cnf=/etc/mysqld-exporter/my.cnf
            - --collect.global_status
            - --web.listen-address=:9104
          # NOUVEAU : Montage du ConfigMap
          volumeMounts:
            - name: config
              mountPath: /etc/mysqld-exporter/
              readOnly: true
          # SUPPRIMER ICI LA SECTION 'env' DATA_SOURCE_NAME (si elle existe)
          # ...
      # NOUVEAU : Définition du Volume ConfigMap
      volumes:
        - name: config
          configMap:
            name: mysqld-exporter-config # Nom du ConfigMap créé à l'étape 1
            items:
              - key: my.cnf
                path: my.cnf
